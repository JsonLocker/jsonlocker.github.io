---
title: DesignDB-5-3_常见主从拓扑
date: 2018-06-24 09:12:13
categories: mysql
tags:
    - designdb
    - 主从拓扑
---
## 主从拓扑

#### 一主多从的复制拓扑

**优点**
- 配置简单
- 多从库可以分担读负载

**用途**
- 为不同业务使用不同的从库
- 将一台从库放到远程IDC中.用于灾备恢复
- 分担主库的读负载

#### 主主复制拓扑

不建议使用这种模式,容易造成数据问题
- 容易产生数据错误
- 会增加数据库的写负载

**注意事项** 
- 两个主中操作的表要尽量分开,避免数据冲突
- 使用下面两个参数控制自增ID的生成
```
auto_increment_increment=2    # 让一台按13579生成,另外一台按2468顺序生成
auto_increment_offset=1|2     # 决定让自增id从哪个值开始,一台按1开始1台按2开始
```
#### 主备模式下的主主复制

**原理**
- 只有1台服务器对外提供服务
- 另外一台只读状态,用于热备使用
- 在对外提供维护或者服务器故障时,热备服务器才进行切换成主库
- 原主库切备库且只读或下线,待维护完成再上线

**配置注意事项**
- 两台mysql初始化数据必须一致
- 两台mysql必须都启用binlog并且有不同的server_id
- 都要启用log_slave_updates参数
- 在初始的备库上需要启用read_only

#### 级联复制

**介绍**
- 在主库和多个从库中间增加一个分发主库
- 用于记录主库的二进制日志
- 分发主库发送二进制日志给多个从库
- 如果从库很多可以增加多个分发主库
- 分发主库必须启用slave_log_updates参数
